<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VRChatãƒ•ã‚©ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
    
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»æ¤œç´¢ã‚¨ãƒªã‚¢ */
        .header {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            padding: 20px;
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .search-container {
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .search-box {
            flex: 1;
            max-width: 400px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 25px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: white;
        }

        .search-box input:focus {
            outline: none;
            border-color: #3498db;
        }

        .search-box input::placeholder {
            color: #95a5a6;
        }

        /* ç¾åœ¨é–‹å‚¬ä¸­ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆPCç‰ˆã®ã¿ï¼‰ */
        .current-events-section {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(238, 90, 36, 0.3);
            margin-bottom: 20px;
            padding: 20px;
            color: white;
            display: none; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§éè¡¨ç¤º */
        }

        .current-events-section.has-events {
            display: block; /* ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ã‚‹æ™‚ã®ã¿è¡¨ç¤º */
        }

        .current-events-section h2 {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .current-events-section h2::before {
            content: "ğŸ”´";
            font-size: 1.2rem;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .current-events-list {
            display: grid;
            gap: 12px;
        }

        .current-event-item {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 16px;
            border-left: 4px solid rgba(255, 255, 255, 0.8);
            transition: transform 0.2s ease;
        }

        .current-event-item:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.2);
        }

        .current-event-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .current-event-info {
            font-size: 0.9rem;
            opacity: 0.9;
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
        }

        .current-event-time {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 500;
        }

        /* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            min-height: 600px;
        }

        /* ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã‚¨ãƒªã‚¢ï¼ˆå·¦å´ï¼‰ */
        .event-details {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 24px;
        }

        .event-details h2 {
            font-size: 1.4rem;
            color: #2c3e50;
            margin-bottom: 16px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 8px;
        }

        .event-info {
            display: none;
        }

        .event-info.active {
            display: block;
        }

        .event-info h3 {
            font-size: 1.2rem;
            color: #3498db;
            margin-bottom: 12px;
        }

        .event-field {
            margin-bottom: 16px;
        }

        .event-field label {
            display: block;
            font-weight: 600;
            color: #555;
            margin-bottom: 4px;
            font-size: 0.9rem;
        }

        .event-field .value {
            background: #f8f9fa;
            padding: 8px 12px;
            border-radius: 6px;
            border-left: 3px solid #3498db;
        }

        .no-event-selected {
            text-align: center;
            color: #95a5a6;
            font-style: italic;
            margin-top: 40px;
        }

        /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¨ãƒªã‚¢ï¼ˆå³å´ï¼‰ */
        .calendar-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }

        #calendar {
            height: 100%;
            min-height: 500px;
        }

        /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .error-message {
            background: #ffe6e6;
            border: 1px solid #ff9999;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: #d32f2f;
            margin: 20px 0;
        }

        .error-message p {
            margin-bottom: 8px;
        }

        .error-message p:last-child {
            margin-bottom: 0;
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* FullCalendar ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .fc-toolbar-title {
            font-size: 1.5rem !important;
            font-weight: 600 !important;
            color: #2c3e50 !important;
        }

        .fc-button-primary {
            background-color: #3498db !important;
            border-color: #3498db !important;
            color: white !important;
        }

        .fc-button-primary:hover {
            background-color: #2980b9 !important;
            border-color: #2980b9 !important;
        }

        .fc-event {
            border-radius: 4px !important;
            border: none !important;
            cursor: pointer !important;
        }

        .fc-event:hover {
            opacity: 0.8 !important;
        }

        /* å¹´è¡¨ç¤ºã‚’å¼·åˆ¶çš„ã«ç„¡åŠ¹åŒ– */
        .fc-multiMonthYear-view {
            display: none !important;
        }

        /* ç¾åœ¨é–‹å‚¬ä¸­ã‚¤ãƒ™ãƒ³ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .fc-event.event-current {
            background-color: #ff6b6b !important;
            border-color: #ee5a24 !important;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 5px rgba(238, 90, 36, 0.5); }
            to { box-shadow: 0 0 10px rgba(238, 90, 36, 0.8), 0 0 15px rgba(238, 90, 36, 0.6); }
        }

        /* PCç‰ˆ - å¹´è¡¨ç¤ºå°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        @media (min-width: 769px) {
            .main-content {
                grid-template-columns: 1fr 2fr;
            }
            .current-events-section {
                display: block; /* PCç‰ˆã§ã¯å¸¸ã«è¡¨ç¤ºé ˜åŸŸã‚’ç¢ºä¿ */
            }
        }

        /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç‰ˆ */
        @media (min-width: 769px) and (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr 1.5fr;
            }
        }

        /* ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« - ç¾åœ¨é–‹å‚¬ä¸­ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º */
        @media (max-width: 768px) {
            /* ç¾åœ¨é–‹å‚¬ä¸­ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒ¢ãƒã‚¤ãƒ«ã§ã¯éè¡¨ç¤º */
            .current-events-section {
                display: none !important;
            }
            
            /* ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ç¸¦ä¸¦ã³ã«å¤‰æ›´ */
            .main-content {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            /* ãƒ˜ãƒƒãƒ€ãƒ¼ã®èª¿æ•´ */
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .header h1 {
                font-size: 1.4rem;
                margin-bottom: 12px;
            }
            
            /* æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã®èª¿æ•´ */
            .search-container {
                flex-direction: column;
            }
            
            .search-box {
                max-width: none;
            }
            
            .search-box input {
                padding: 14px 18px; /* ã‚¿ãƒƒãƒã—ã‚„ã™ã„ã‚µã‚¤ã‚ºã« */
                font-size: 16px; /* iOSã®ã‚ºãƒ¼ãƒ é˜²æ­¢ */
            }
            
            /* ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã‚¨ãƒªã‚¢ã®èª¿æ•´ */
            .event-details {
                padding: 16px;
                order: 1; /* ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã‚’ä¸Šã«ç§»å‹• */
            }
            
            /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¨ãƒªã‚¢ã®èª¿æ•´ */
            .calendar-container {
                padding: 12px;
                order: 2; /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ä¸‹ã«ç§»å‹• */
            }
            
            /* FullCalendar ToolBarã®å¤§å¹…æ”¹å–„ */
            .fc-toolbar {
                flex-direction: column !important;
                gap: 12px !important;
                padding: 8px 4px !important;
            }
            
            .fc-toolbar-chunk {
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
            }
            
            /* ãƒœã‚¿ãƒ³ã‚µã‚¤ã‚ºã‚’å¤§ãã */
            .fc-button {
                padding: 10px 16px !important;
                font-size: 14px !important;
                min-height: 44px !important; /* Appleæ¨å¥¨ã‚¿ãƒƒãƒã‚µã‚¤ã‚º */
                margin: 0 2px !important;
            }
            
            /* ã‚¿ã‚¤ãƒˆãƒ«ã®èª¿æ•´ */
            .fc-toolbar-title {
                font-size: 1.2rem !important;
                margin: 8px 0 !important;
                text-align: center !important;
            }
            
            /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æœ¬ä½“ã®èª¿æ•´ */
            .fc-daygrid-event {
                font-size: 12px !important;
                padding: 2px 4px !important;
            }
            
            .fc-col-header-cell {
                padding: 8px 2px !important;
            }
            
            .fc-daygrid-day-number {
                padding: 8px !important;
                font-size: 14px !important;
            }
        }

        /* æ¥µå°ç”»é¢ï¼ˆiPhone SEç­‰ï¼‰å¯¾å¿œ */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.2rem;
            }
            
            .fc-button {
                padding: 8px 12px !important;
                font-size: 13px !important;
            }
            
            .fc-toolbar-title {
                font-size: 1.1rem !important;
            }
            
            /* ã‚ˆã‚Šèª­ã¿ã‚„ã™ã„ã‚¤ãƒ™ãƒ³ãƒˆè¡¨ç¤º */
            .fc-daygrid-event {
                font-size: 11px !important;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
            
            /* ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã®èª¿æ•´ */
            .event-details {
                padding: 12px;
            }
            
            .event-field .value {
                padding: 6px 10px;
                font-size: 14px;
                line-height: 1.4;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»æ¤œç´¢ã‚¨ãƒªã‚¢ -->
        <div class="header">
            <h1>VRChatãƒ•ã‚©ãƒˆã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1>
            <div class="search-container">
                <div class="search-box">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="ã‚¤ãƒ™ãƒ³ãƒˆåã€èª¬æ˜ã€ä¸»å‚¬è€…ã§æ¤œç´¢..."
                        aria-label="ã‚¤ãƒ™ãƒ³ãƒˆæ¤œç´¢"
                        autocomplete="off"
                        autocapitalize="off"
                        autocorrect="off"
                    >
                </div>
            </div>
        </div>

        <!-- ç¾åœ¨é–‹å‚¬ä¸­ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆPCç‰ˆã®ã¿ï¼‰ -->
        <div class="current-events-section" id="currentEventsSection">
            <h2>ç¾åœ¨é–‹å‚¬ä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆ</h2>
            <div class="current-events-list" id="currentEventsList">
                <!-- ç¾åœ¨é–‹å‚¬ä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒã“ã“ã«å‹•çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
            </div>
        </div>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <div class="main-content">
            <!-- ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã‚¨ãƒªã‚¢ï¼ˆå·¦å´ï¼‰ -->
            <div class="event-details">
                <h2>ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°</h2>
                
                <div class="no-event-selected" id="noEventMessage">
                    ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’é¸æŠã—ã¦ãã ã•ã„
                </div>
                
                <div class="event-info" id="eventInfo">
                    <h3 id="eventTitle">ã‚¤ãƒ™ãƒ³ãƒˆå</h3>
                    
                    <div class="event-field">
                        <label>æ—¥æ™‚</label>
                        <div class="value" id="eventDate">-</div>
                    </div>
                    
                    <div class="event-field">
                        <label>èª¬æ˜</label>
                        <div class="value" id="eventDescription">-</div>
                    </div>
                    
                    <div class="event-field">
                        <label>ãƒ¯ãƒ¼ãƒ«ãƒ‰/ä¼šå ´</label>
                        <div class="value" id="eventWorld">-</div>
                    </div>
                    
                    <div class="event-field">
                        <label>ä¸»å‚¬è€…</label>
                        <div class="value" id="eventOrganizer">-</div>
                    </div>
                    
                    <div class="event-field">
                        <label>å‚åŠ æ–¹æ³•</label>
                        <div class="value" id="eventJoinMethod">-</div>
                    </div>
                    
                    <div class="event-field">
                        <label>ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </label>
                        <div class="value" id="eventPlatform">-</div>
                    </div>
                    
                    <div class="event-field">
                        <label>æƒ…å ±æº</label>
                        <div class="value" id="eventSource">-</div>
                    </div>
                </div>
            </div>

            <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¨ãƒªã‚¢ï¼ˆå³å´ï¼‰ -->
            <div class="calendar-container">
                <div id="loadingMessage" class="loading">
                    <div class="loading-spinner"></div>
                    <p>ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>
                <div id="calendar"></div>
            </div>
        </div>
    </div>

    <!-- FullCalendar JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¦ç´ ã‚’å–å¾—
            const calendarEl = document.getElementById('calendar');
            const loadingEl = document.getElementById('loadingMessage');
            let allEvents = []; // å…¨ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿æŒ
            
            // ãƒ¢ãƒã‚¤ãƒ«æ¤œå‡º
            function isMobile() {
                return window.innerWidth <= 768;
            }
            
            // PC/ãƒ¢ãƒã‚¤ãƒ«ã«å¿œã˜ãŸåˆæœŸãƒ“ãƒ¥ãƒ¼ã‚’æ±ºå®š
            function getInitialView() {
                return isMobile() ? 'dayGridMonth' : 'multiMonthYear';
            }
            
            // PC/ãƒ¢ãƒã‚¤ãƒ«ã«å¿œã˜ãŸãƒ˜ãƒƒãƒ€ãƒ¼ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‚’æ±ºå®š
            function getHeaderToolbar() {
                return {
                    left: 'prev,next',
                    center: 'title',
                    right: ''
                };
            }
            
            // ãƒ†ã‚­ã‚¹ãƒˆã‚µãƒ‹ã‚¿ã‚¤ã‚ºé–¢æ•°
            function sanitizeText(text) {
                if (!text) return '-';
                const div = document.createElement('div');
                div.textContent = text;
                return div.textContent;
            }
            
            // ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºé–¢æ•°
            function showError(message) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'error-message';
                errorDiv.innerHTML = `
                    <p>âš ï¸ ${message}</p>
                    <p>ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„</p>
                `;
                
                const calendarContainer = document.querySelector('.calendar-container');
                calendarContainer.appendChild(errorDiv);
                loadingEl.style.display = 'none';
            }
            
            // ç¾åœ¨é–‹å‚¬ä¸­ã‚¤ãƒ™ãƒ³ãƒˆã®åˆ¤å®š
            function isEventCurrent(eventDate, duration = 2) {
                const now = new Date();
                const eventStart = new Date(eventDate);
                const eventEnd = new Date(eventStart.getTime() + duration * 60 * 60 * 1000); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ2æ™‚é–“
                
                return now >= eventStart && now <= eventEnd;
            }
            
            // ç¾åœ¨é–‹å‚¬ä¸­ã‚¤ãƒ™ãƒ³ãƒˆã®è¡¨ç¤ºæ›´æ–°
            function updateCurrentEvents(events) {
                const currentEventsSection = document.getElementById('currentEventsSection');
                const currentEventsList = document.getElementById('currentEventsList');
                
                // PCç‰ˆã§ã®ã¿å‡¦ç†
                if (isMobile()) {
                    currentEventsSection.style.display = 'none';
                    return;
                }
                
                // ç¾åœ¨é–‹å‚¬ä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æŠ½å‡º
                const currentEvents = events.filter(event => {
                    return isEventCurrent(event.start);
                });
                
                // ç¾åœ¨é–‹å‚¬ä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚ã‚‹ã‹ã©ã†ã‹ã§ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºã‚’åˆ¶å¾¡
                if (currentEvents.length > 0) {
                    currentEventsSection.classList.add('has-events');
                    
                    // ç¾åœ¨é–‹å‚¬ä¸­ã‚¤ãƒ™ãƒ³ãƒˆã®HTMLç”Ÿæˆ
                    const currentEventsHTML = currentEvents.map(event => {
                        const eventTime = new Date(event.start).toLocaleTimeString('ja-JP', {
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        return `
                            <div class="current-event-item" onclick="selectCurrentEvent('${event.id}')">
                                <div class="current-event-title">${sanitizeText(event.title)}</div>
                                <div class="current-event-info">
                                    <span class="current-event-time">${eventTime}ã€œ</span>
                                    <span>ä¸»å‚¬: ${sanitizeText(event.extendedProps.organizer)}</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    currentEventsList.innerHTML = currentEventsHTML;
                } else {
                    currentEventsSection.classList.remove('has-events');
                }
            }
            
            // ç¾åœ¨é–‹å‚¬ä¸­ã‚¤ãƒ™ãƒ³ãƒˆã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
            window.selectCurrentEvent = function(eventId) {
                const event = allEvents.find(e => e.id === eventId);
                if (event) {
                    showEventDetails(event);
                    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ãã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
                    calendar.select(event.start);
                }
            };
            
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¨­å®š
            const calendarConfig = {
                initialView: getInitialView(),
                locale: 'ja',
                headerToolbar: getHeaderToolbar(),
                buttonText: {
                    year: 'å¹´',
                    today: 'ä»Šæ—¥',
                    month: 'æœˆ',
                    week: 'é€±',
                    day: 'æ—¥',
                    list: 'ãƒªã‚¹ãƒˆ'
                },
                height: 'auto',
                eventDisplay: 'block',
                dayMaxEvents: isMobile() ? 2 : 3,
                displayEventTime: false,
                moreLinkText: function(num) {
                    return '+' + num + ' ä»¶';
                },
                // ã‚¤ãƒ™ãƒ³ãƒˆã‚¯ãƒªãƒƒã‚¯æ™‚ã®å‡¦ç†
                eventClick: function(info) {
                    showEventDetails(info.event);
                    // ãƒ¢ãƒã‚¤ãƒ«ã®å ´åˆã¯ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
                    if (isMobile()) {
                        setTimeout(() => {
                            document.getElementById('eventInfo').scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                        }, 100);
                    }
                },
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å¾Œã®å‡¦ç†
                eventDidMount: function(info) {
                    // ç¾åœ¨é–‹å‚¬ä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨
                    if (isEventCurrent(info.event.start)) {
                        info.el.classList.add('event-current');
                    }
                },
                // ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å‹•çš„ã«èª­ã¿è¾¼ã¿
                events: function(info, successCallback, failureCallback) {
                    // å®Ÿéš›ã®JSONãƒ‡ãƒ¼ã‚¿ï¼ˆæ‹¡å¼µç‰ˆï¼‰
                    const jsonData = {
                        "events": [
                            {
                                "event_name": "VRCã€Œæ’®å½±ã®é›†ã„ã€",
                                "date": "2024-09-02T22:00:00+09:00",
                                "description": "æ¯é€±æœˆæ›œæ—¥22:00-24:00é–‹å‚¬ã®å®šæœŸæ’®å½±ä¼šã€‚å†™çœŸå¥½ããŒé›†ã¾ã‚‹æœ€ã‚‚äººæ°—ã®æ’®å½±ã‚¤ãƒ™ãƒ³ãƒˆã€‚åˆå¿ƒè€…æ­“è¿ã§åŸºæœ¬çš„ãªã‚«ãƒ¡ãƒ©æ“ä½œæŒ‡å°ã‚‚ã‚ã‚Šã€‚æ¯å›70-80åå‚åŠ ã€‚",
                                "world": "é€±æ›¿ã‚ã‚Šï¼ˆæ’®å½±å‘ã‘ãƒ¯ãƒ¼ãƒ«ãƒ‰é¸å®šï¼‰",
                                "organizer": "Reg(åœŸ)ã•ã‚“ (@ANCR_eret)",
                                "join_method": "ä¸»å‚¬è€…ã¸ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹å¾Œã€é–‹å‚¬æ™‚é–“ã«Join",
                                "platform": "PC/Quest",
                                "source": "VR Life Magazine / @vrc_phototsudoi"
                            },
                            {
                                "event_name": "VRC Avatar Collectionã€Œ1Dozen Collectionã€Col.1",
                                "date": "2024-11-04T21:00:00+09:00",
                                "description": "12ä½“ã®æ–°ä½œã‚¢ãƒã‚¿ãƒ¼ã‚’ç´¹ä»‹ã™ã‚‹ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³ã‚·ãƒ§ãƒ¼å½¢å¼ã®æ’®å½±ã‚¤ãƒ™ãƒ³ãƒˆã€‚ãƒ©ãƒ³ã‚¦ã‚§ã‚¤å½¢å¼ã§æ–°ä½œã‚¢ãƒã‚¿ãƒ¼ã®é­…åŠ›ã‚’æ’®å½±ã§ãã‚‹é«˜å“è³ªã‚¤ãƒ™ãƒ³ãƒˆã€‚å‚åŠ è€…60åé™å®šã€‚",
                                "world": "Collectionå°‚ç”¨ãƒ©ãƒ³ã‚¦ã‚§ã‚¤ãƒ¯ãƒ¼ãƒ«ãƒ‰",
                                "organizer": "VRC Avatar Collection (@vrc_avacolle)",
                                "join_method": "äº‹å‰ç”³è¾¼åˆ¶ï¼ˆå‚åŠ è€…60åé™å®šï¼‰",
                                "platform": "PC/Questï¼ˆPoorãƒ©ãƒ³ã‚¯ä»¥ä¸Šã®ã‚¢ãƒã‚¿ãƒ¼å¿…é ˆï¼‰",
                                "source": "X (Twitter) @vrc_avacolle"
                            },
                            {
                                "event_name": "Virtual Market 2024 Winter ãƒ•ã‚©ãƒˆã‚¨ãƒªã‚¢",
                                "date": "2024-12-21T12:00:00+09:00",
                                "description": "ä¸–ç•Œæœ€å¤§è¦æ¨¡ã®VRã‚¤ãƒ™ãƒ³ãƒˆã€Œãƒãƒ¼ãƒãƒ£ãƒ«ãƒãƒ¼ã‚±ãƒƒãƒˆã€å†…ã®æ’®å½±å°‚ç”¨ã‚¨ãƒªã‚¢ã€‚æ–°ä½œã‚¢ãƒã‚¿ãƒ¼ã‚„ãƒ¯ãƒ¼ãƒ«ãƒ‰ã§ã®æ’®å½±ãŒæ¥½ã—ã‚ã‚‹æœŸé–“é™å®šå¤§å‹ã‚¤ãƒ™ãƒ³ãƒˆã€‚",
                                "world": "Virtual Market 2024 Winterå„ä¼šå ´",
                                "organizer": "HIKKY / Virtual Marketé‹å–¶",
                                "join_method": "Vketãƒ¯ãƒ¼ãƒ«ãƒ‰ã¸ç›´æ¥å‚åŠ ",
                                "platform": "PC/Quest",
                                "source": "Virtual Marketå…¬å¼ã‚µã‚¤ãƒˆ"
                            },
                            {
                                "event_name": "Japan Streetæ–°å¹´é›†åˆå†™çœŸ",
                                "date": "2025-01-01T23:00:00+09:00",
                                "description": "æ—¥æœ¬æœ€å¤§ã®VRChatã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ãƒãƒ–ã€ŒJapan Streetã€ã§ã®æ–°å¹´æ’ä¾‹é›†åˆå†™çœŸã‚¤ãƒ™ãƒ³ãƒˆã€‚æ¯å¹´å¤šæ•°ã®å‚åŠ è€…ãŒé›†ã¾ã‚‹ä¼çµ±è¡Œäº‹ã€‚42,000ä»¥ä¸Šã®ãŠæ°—ã«å…¥ã‚Šã‚’æŒã¤äººæ°—ãƒ¯ãƒ¼ãƒ«ãƒ‰ã€‚",
                                "world": "Japan Street",
                                "organizer": "Japan Street ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ (NEET ENGINEERåˆ¶ä½œ)",
                                "join_method": "Japan Street Discord (discord.gg/YhK4gXr) ã¾ãŸã¯ç›´æ¥å‚åŠ ",
                                "platform": "PC/Quest",
                                "source": "VRChat Wiki"
                            },
                            {
                                "event_name": "ç¾åœ¨é–‹å‚¬ä¸­ãƒ†ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ",
                                "date": new Date().toISOString(),
                                "description": "ç¾åœ¨é–‹å‚¬ä¸­ã®è¡¨ç¤ºãƒ†ã‚¹ãƒˆç”¨ã®ã‚µãƒ³ãƒ—ãƒ«ã‚¤ãƒ™ãƒ³ãƒˆã§ã™ã€‚å®Ÿéš›ã«ã¯å­˜åœ¨ã—ã¾ã›ã‚“ã€‚",
                                "world": "ãƒ†ã‚¹ãƒˆç”¨ãƒ¯ãƒ¼ãƒ«ãƒ‰",
                                "organizer": "ãƒ†ã‚¹ãƒˆä¸»å‚¬è€…",
                                "join_method": "ãƒ†ã‚¹ãƒˆå‚åŠ æ–¹æ³•",
                                "platform": "PC/Quest",
                                "source": "ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿"
                            },
                            {
                                "event_name": "VRCå¤œæ™¯æ’®å½±ä¼šã€é–‹å‚¬ä¸­ã€‘",
                                "date": new Date(Date.now() - 30 * 60 * 1000).toISOString(),
                                "description": "æ±äº¬ã®ç¾ã—ã„å¤œæ™¯ã‚’èƒŒæ™¯ã«ã—ãŸæ’®å½±ä¼šã€‚ç¾åœ¨é–‹å‚¬ä¸­ã®ã‚¤ãƒ™ãƒ³ãƒˆã§ã™ã€‚åˆå¿ƒè€…å¤§æ­“è¿ï¼",
                                "world": "Tokyo Night View World",
                                "organizer": "å¤œæ™¯æ’®å½±ã‚µãƒ¼ã‚¯ãƒ« (@yakai_vrc)",
                                "join_method": "ä¸»å‚¬è€…ã«ãƒ•ãƒ¬ãƒ³ãƒ‰ç”³è«‹å¾ŒJoin",
                                "platform": "PC/Quest",
                                "source": "VRCæ’®å½±ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£"
                            },
                            {
                                "event_name": "VRCãƒ•ã‚©ãƒˆäº¤æµä¼šã€é–‹å‚¬ä¸­ã€‘",
                                "date": new Date(Date.now() - 60 * 60 * 1000).toISOString(),
                                "description": "å†™çœŸå¥½ããŒé›†ã¾ã‚‹äº¤æµä¼šã€‚ç¾åœ¨é–‹å‚¬ä¸­ã§ã™ï¼æ’®å½±ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã®å…±æœ‰ã‚„ã‚¢ãƒã‚¿ãƒ¼æ’®å½±ãªã©ç››ã‚Šã ãã•ã‚“ã€‚",
                                "world": "Photo Studio World",
                                "organizer": "ãƒ•ã‚©ãƒˆäº¤æµã‚µãƒ¼ã‚¯ãƒ« (@photo_vrc)",
                                "join_method": "DiscordçµŒç”±ã§å‚åŠ ",
                                "platform": "PC/Quest",
                                "source": "VRCãƒ•ã‚©ãƒˆã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£"
                            },
                            {
                                "event_name": "å¼·åˆ¶è¡¨ç¤ºãƒ†ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆ",
                                "date": new Date(Date.now() - 10 * 60 * 1000).toISOString(),
                                "description": "ç¢ºå®Ÿã«ç¾åœ¨é–‹å‚¬ä¸­ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ãƒ†ã‚¹ãƒˆã‚¤ãƒ™ãƒ³ãƒˆï¼ˆ10åˆ†å‰é–‹å§‹ï¼‰",
                                "world": "å¼·åˆ¶è¡¨ç¤ºãƒ¯ãƒ¼ãƒ«ãƒ‰",
                                "organizer": "ãƒ‡ãƒãƒƒã‚°ç”¨ä¸»å‚¬è€…",
                                "join_method": "ãƒ†ã‚¹ãƒˆå‚åŠ ",
                                "platform": "PC/Quest",
                                "source": "ãƒ‡ãƒãƒƒã‚°ãƒ‡ãƒ¼ã‚¿"
                            }
                        ]
                    };
                    
                    try {
                        // ãƒ‡ãƒ¼ã‚¿æ¤œè¨¼
                        if (!jsonData || !Array.isArray(jsonData.events)) {
                            throw new Error('ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
                        }
                        
                        // æœ‰åŠ¹ãªã‚¤ãƒ™ãƒ³ãƒˆã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                        const validEvents = jsonData.events.filter(event => {
                            return event.event_name && 
                                   event.date && 
                                   event.date.trim() !== '';
                        });
                        
                        if (validEvents.length === 0) {
                            throw new Error('æœ‰åŠ¹ãªã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                        }
                        
                        // JSONãƒ‡ãƒ¼ã‚¿ã‚’FullCalendarç”¨ã®ã‚¤ãƒ™ãƒ³ãƒˆå½¢å¼ã«å¤‰æ›
                        const events = validEvents.map((event, index) => ({
                            id: `event-${index}`,
                            title: sanitizeText(event.event_name),
                            start: event.date,
                            backgroundColor: getEventColor(index),
                            borderColor: getEventColor(index),
                            extendedProps: {
                                description: sanitizeText(event.description),
                                world: sanitizeText(event.world),
                                organizer: sanitizeText(event.organizer),
                                join_method: sanitizeText(event.join_method),
                                platform: sanitizeText(event.platform),
                                source: sanitizeText(event.source)
                            }
                        }));
                        
                        // å…¨ã‚¤ãƒ™ãƒ³ãƒˆã‚’ä¿æŒ
                        allEvents = events;
                        
                        // ç¾åœ¨é–‹å‚¬ä¸­ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›´æ–°
                        updateCurrentEvents(events);
                        
                        loadingEl.style.display = 'none';
                        successCallback(events);
                    } catch (error) {
                        console.error('ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
                        showError('ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
                        failureCallback(error);
                    }
                }
            };
            
            // FullCalendarã‚’åˆæœŸåŒ–
            calendar = new FullCalendar.Calendar(calendarEl, calendarConfig);
            
            // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’è¡¨ç¤º
            calendar.render();
            
            // åˆæœŸåŒ–å¾Œã«æœˆè¡¨ç¤ºã‚’ç¢ºå®Ÿã«ã™ã‚‹
            setTimeout(() => {
                if (calendar.view.type !== 'dayGridMonth') {
                    calendar.changeView('dayGridMonth');
                }
            }, 100);
            
            // ã‚¤ãƒ™ãƒ³ãƒˆè‰²ã‚’å–å¾—ã™ã‚‹é–¢æ•°
            function getEventColor(index) {
                const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#34495e', '#e67e22'];
                return colors[index % colors.length];
            }
            
            // ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
            function showEventDetails(event) {
                const noEventMessage = document.getElementById('noEventMessage');
                const eventInfo = document.getElementById('eventInfo');
                
                // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’éš ã—ã¦ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã‚’è¡¨ç¤º
                noEventMessage.style.display = 'none';
                eventInfo.classList.add('active');
                
                // ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ã‚’æ›´æ–°
                document.getElementById('eventTitle').textContent = event.title;
                document.getElementById('eventDate').textContent = formatEventDate(event.start, event.end);
                document.getElementById('eventDescription').textContent = event.extendedProps.description;
                document.getElementById('eventWorld').textContent = event.extendedProps.world;
                document.getElementById('eventOrganizer').textContent = event.extendedProps.organizer;
                document.getElementById('eventJoinMethod').textContent = event.extendedProps.join_method;
                document.getElementById('eventPlatform').textContent = event.extendedProps.platform;
                document.getElementById('eventSource').textContent = event.extendedProps.source;
            }
            
            // æ—¥æ™‚ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé–¢æ•°
            function formatEventDate(start, end) {
                const options = {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long',
                    hour: '2-digit',
                    minute: '2-digit'
                };
                
                let dateString = start.toLocaleDateString('ja-JP', options);
                
                if (end) {
                    const endTime = end.toLocaleTimeString('ja-JP', {
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    dateString += ' ï½ ' + endTime;
                }
                
                return dateString;
            }
            
            // æ¤œç´¢æ©Ÿèƒ½ï¼ˆãƒ‡ãƒã‚¦ãƒ³ã‚¹ä»˜ãï¼‰
            let searchTimeout;
            const searchInput = document.getElementById('searchInput');
            
            function performSearch(searchTerm) {
                const normalizedTerm = searchTerm.toLowerCase().trim();
                
                // å…¨ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—
                const allCalendarEvents = calendar.getEvents();
                
                // æ¤œç´¢çµæœã«åŸºã¥ã„ã¦ã‚¤ãƒ™ãƒ³ãƒˆã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆ
                allCalendarEvents.forEach(event => {
                    const title = event.title.toLowerCase();
                    const description = (event.extendedProps.description || '').toLowerCase();
                    const organizer = (event.extendedProps.organizer || '').toLowerCase();
                    
                    const isVisible = normalizedTerm === '' || 
                        title.includes(normalizedTerm) || 
                        description.includes(normalizedTerm) || 
                        organizer.includes(normalizedTerm);
                    
                    // ã‚¤ãƒ™ãƒ³ãƒˆã®è¡¨ç¤º/éè¡¨ç¤ºã‚’åˆ¶å¾¡
                    event.setProp('display', isVisible ? 'auto' : 'none');
                });
                
                // ç¾åœ¨é–‹å‚¬ä¸­ã‚¤ãƒ™ãƒ³ãƒˆã‚‚æ¤œç´¢çµæœã«åŸºã¥ã„ã¦æ›´æ–°
                const filteredEvents = allEvents.filter(event => {
                    const title = event.title.toLowerCase();
                    const description = (event.extendedProps.description || '').toLowerCase();
                    const organizer = (event.extendedProps.organizer || '').toLowerCase();
                    
                    return normalizedTerm === '' || 
                           title.includes(normalizedTerm) || 
                           description.includes(normalizedTerm) || 
                           organizer.includes(normalizedTerm);
                });
                
                updateCurrentEvents(filteredEvents);
            }
            
            searchInput.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performSearch(e.target.value);
                }, 300); // 300mså¾Œã«æ¤œç´¢å®Ÿè¡Œ
            });
            
            // ç¾åœ¨é–‹å‚¬ä¸­ã‚¤ãƒ™ãƒ³ãƒˆã®å®šæœŸæ›´æ–°ï¼ˆ1åˆ†ã”ã¨ï¼‰
            setInterval(() => {
                if (!isMobile() && allEvents.length > 0) {
                    updateCurrentEvents(allEvents);
                    
                    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä¸Šã®ã‚¤ãƒ™ãƒ³ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã‚‚æ›´æ–°
                    const calendarEvents = calendar.getEvents();
                    calendarEvents.forEach(event => {
                        const eventEl = event.getElement();
                        if (eventEl) {
                            if (isEventCurrent(event.start)) {
                                eventEl.classList.add('event-current');
                            } else {
                                eventEl.classList.remove('event-current');
                            }
                        }
                    });
                }
            }, 60000); // 60ç§’ã”ã¨
            
            // ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºæ™‚ã®å¯¾å¿œ
            window.addEventListener('resize', function() {
                if (calendar) {
                    // PCãƒ»ãƒ¢ãƒã‚¤ãƒ«å…±ã«æœˆè¡¨ç¤ºã‚’ç¶­æŒ
                    if (calendar.view.type !== 'dayGridMonth') {
                        calendar.changeView('dayGridMonth');
                    }
                    
                    // ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã‚’æ›´æ–°
                    calendar.setOption('headerToolbar', getHeaderToolbar());
                    
                    // ç¾åœ¨é–‹å‚¬ä¸­ã‚¤ãƒ™ãƒ³ãƒˆã®è¡¨ç¤ºæ›´æ–°
                    updateCurrentEvents(allEvents);
                }
            });
            
            // ãƒšãƒ¼ã‚¸ã®å¯è¦–æ€§å¤‰æ›´æ™‚ã®å‡¦ç†ã¯ä¸è¦ï¼ˆãƒ‡ãƒ¼ã‚¿æ›´æ–°ãªã—ï¼‰
            // document.addEventListener('visibilitychange', function() {
            //     if (!document.hidden && allEvents.length > 0) {
            //         // ãƒšãƒ¼ã‚¸ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ãªã£ãŸæ™‚ã«ç¾åœ¨é–‹å‚¬ä¸­ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›´æ–°
            //         updateCurrentEvents(allEvents);
            //     }
            // }); // å‰Šé™¤ï¼šãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ãªã—
        });
    </script>
</body>
</html>
                